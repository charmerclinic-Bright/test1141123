import React, { useState } from 'react';
import { Calendar, Clock, MapPin, User, Mail, Briefcase, Coffee, MessageSquare, CheckCircle, Info, Send, Loader2, AlertCircle } from 'lucide-react';

// 【已更新】這是您提供的 Google Apps Script 網址
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwrtXllCcdNghlOligSzQOwM2eEqQNvW2RabZPPqi5zDcudR3qqzWVHrxhvZrTyUHf_/exec"; 

const App = () => {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    jobTitle: '',
    needsSnack: 'yes',
    question: ''
  });

  const [status, setStatus] = useState('idle'); // idle, submitting, success, error
  const [errorMessage, setErrorMessage] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setStatus('submitting');
    setErrorMessage('');

    try {
      // 由於 Google Apps Script 的 CORS 限制，我們使用 no-cors 模式發送
      // 這意味著我們無法直接讀取回應的 JSON，但可以確保請求成功發送
      // 這種方式對於簡單的表單提交是最穩定的
      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors', 
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
      });

      // 因為 no-cors 模式不會拋出錯誤，我們假設請求發送成功
      // 為了更好的體驗，稍微延遲一點讓使用者看到 loading 動畫
      setTimeout(() => {
        console.log('Form Submitted to Google Sheets:', formData);
        setStatus('success');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 1000);

    } catch (error) {
      console.error('Submission Error:', error);
      setStatus('error');
      setErrorMessage('連線發生錯誤，請稍後再試或直接聯繫主辦單位。');
    }
  };

  if (status === 'success') {
    return (
      <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
        <div className="bg-white max-w-md w-full p-8 rounded-2xl shadow-xl text-center animate-fade-in-up">
          <div className="mx-auto w-20 h-20 bg-teal-100 rounded-full flex items-center justify-center mb-6">
            <CheckCircle className="w-10 h-10 text-teal-600" />
          </div>
          <h2 className="text-2xl font-bold text-slate-800 mb-2">報名成功！</h2>
          <p className="text-slate-600 mb-6">
            感謝您報名參加「敏捷思維導入教學行政」研討會。<br/>
            資料已同步傳送至系統，我們期待與您相見！
          </p>
          <div className="bg-slate-50 rounded-lg p-4 text-left text-sm text-slate-500 mb-6">
            <p><span className="font-medium">姓名：</span> {formData.name}</p>
            <p><span className="font-medium">Email：</span> {formData.email}</p>
            <p><span className="font-medium">茶點：</span> {formData.needsSnack === 'yes' ? '需要' : '不需要'}</p>
          </div>
          <button 
            onClick={() => {
              setStatus('idle');
              setFormData({ name: '', email: '', jobTitle: '', needsSnack: 'yes', question: '' });
            }}
            className="w-full py-3 bg-teal-500 hover:bg-teal-600 text-white font-medium rounded-xl transition duration-200 shadow-md hover:shadow-lg"
          >
            返回首頁
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-slate-50 font-sans selection:bg-teal-200 selection:text-teal-900">
      {/* 裝飾背景圓型 */}
      <div className="fixed top-0 left-0 w-full h-96 bg-gradient-to-br from-teal-400 to-sky-400 opacity-10 rounded-b-[3rem] -z-10"></div>
      
      <div className="max-w-4xl mx-auto px-4 py-8 md:py-12">
        
        {/* Header 區塊 */}
        <header className="text-center mb-10 animate-fade-in">
          <div className="inline-block px-4 py-1 bg-teal-100 text-teal-700 rounded-full text-sm font-semibold mb-4 tracking-wide shadow-sm">
            2025 教學部年度鉅獻
          </div>
          <h1 className="text-3xl md:text-4xl font-extrabold text-slate-800 mb-2 tracking-tight">
            敏捷思維導入教學行政
          </h1>
          <h2 className="text-lg md:text-xl text-slate-600 font-medium">
            Hello World 2025 開發者大會心得分享暨實務研討會
          </h2>
        </header>

        <div className="grid md:grid-cols-3 gap-6">
          
          {/* 左側：活動資訊卡片 */}
          <div className="md:col-span-1 space-y-6">
            <div className="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 relative overflow-hidden group hover:shadow-xl transition-all duration-300">
              <div className="absolute top-0 right-0 w-24 h-24 bg-teal-50 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
              
              <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center relative z-10">
                <Info className="w-5 h-5 mr-2 text-teal-500" />
                活動資訊
              </h3>
              
              <div className="space-y-4 relative z-10">
                <div className="flex items-start">
                  <div className="bg-sky-50 p-2 rounded-lg mr-3">
                    <Calendar className="w-5 h-5 text-sky-500" />
                  </div>
                  <div>
                    <p className="text-xs text-slate-400 font-semibold uppercase tracking-wider">日期</p>
                    <p className="text-slate-700 font-medium">2025 年 10 月 31 日 (五)</p>
                  </div>
                </div>

                <div className="flex items-start">
                  <div className="bg-orange-50 p-2 rounded-lg mr-3">
                    <Clock className="w-5 h-5 text-orange-500" />
                  </div>
                  <div>
                    <p className="text-xs text-slate-400 font-semibold uppercase tracking-wider">時間</p>
                    <p className="text-slate-700 font-medium">14:00 - 15:30</p>
                    <p className="text-xs text-slate-500">(共 1.5 小時)</p>
                  </div>
                </div>

                <div className="flex items-start">
                  <div className="bg-indigo-50 p-2 rounded-lg mr-3">
                    <MapPin className="w-5 h-5 text-indigo-500" />
                  </div>
                  <div>
                    <p className="text-xs text-slate-400 font-semibold uppercase tracking-wider">地點</p>
                    <p className="text-slate-700 font-medium">教學部會議室</p>
                  </div>
                </div>
              </div>

              <div className="mt-6 pt-6 border-t border-slate-100">
                <p className="text-sm text-slate-600 leading-relaxed">
                  <span className="font-bold text-teal-600 block mb-1">活動目的：</span>
                  分享「敏捷開發 (Agile)」核心精神，探討如何應用於 QCC、OSCE 籌備等行政專案，提升團隊效率。
                </p>
              </div>
            </div>
            
            {/* 裝飾性小卡片 */}
            <div className="hidden md:block bg-gradient-to-br from-teal-500 to-cyan-600 p-6 rounded-2xl shadow-lg text-white">
              <p className="font-bold text-lg mb-2">為什麼要參加？</p>
              <ul className="text-sm space-y-2 text-teal-50 list-disc list-inside">
                <li>學習高效工作法</li>
                <li>優化行政流程</li>
                <li>跨領域經驗交流</li>
              </ul>
            </div>
          </div>

          {/* 右側：報名表單 */}
          <div className="md:col-span-2">
            <div className="bg-white rounded-2xl shadow-xl border-t-4 border-teal-400 overflow-hidden">
              <div className="p-8">
                <div className="flex items-center justify-between mb-8">
                  <h3 className="text-2xl font-bold text-slate-800">線上報名</h3>
                  <span className="text-xs font-semibold bg-red-50 text-red-500 px-3 py-1 rounded-full animate-pulse">
                    名額有限
                  </span>
                </div>

                {status === 'error' && (
                  <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-xl text-red-600 flex items-center animate-shake">
                    <AlertCircle className="w-5 h-5 mr-2 flex-shrink-0" />
                    <span className="text-sm">{errorMessage || '發生未知錯誤'}</span>
                  </div>
                )}

                <form onSubmit={handleSubmit} className="space-y-6">
                  {/* 姓名與 Email */}
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="space-y-2">
                      <label htmlFor="name" className="text-sm font-semibold text-slate-700 flex items-center">
                        <User className="w-4 h-4 mr-1 text-slate-400" /> 姓名 <span className="text-red-500 ml-1">*</span>
                      </label>
                      <input
                        type="text"
                        id="name"
                        name="name"
                        required
                        disabled={status === 'submitting'}
                        value={formData.name}
                        onChange={handleChange}
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all outline-none bg-slate-50 focus:bg-white disabled:bg-slate-100 disabled:text-slate-400"
                        placeholder="請輸入您的姓名"
                      />
                    </div>
                    <div className="space-y-2">
                      <label htmlFor="email" className="text-sm font-semibold text-slate-700 flex items-center">
                        <Mail className="w-4 h-4 mr-1 text-slate-400" /> 電子郵件 <span className="text-red-500 ml-1">*</span>
                      </label>
                      <input
                        type="email"
                        id="email"
                        name="email"
                        required
                        disabled={status === 'submitting'}
                        value={formData.email}
                        onChange={handleChange}
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all outline-none bg-slate-50 focus:bg-white disabled:bg-slate-100 disabled:text-slate-400"
                        placeholder="example@email.com"
                      />
                    </div>
                  </div>

                  {/* 職稱 */}
                  <div className="space-y-2">
                    <label htmlFor="jobTitle" className="text-sm font-semibold text-slate-700 flex items-center">
                      <Briefcase className="w-4 h-4 mr-1 text-slate-400" /> 職稱 <span className="text-red-500 ml-1">*</span>
                    </label>
                    <div className="relative">
                      <select
                        id="jobTitle"
                        name="jobTitle"
                        required
                        disabled={status === 'submitting'}
                        value={formData.jobTitle}
                        onChange={handleChange}
                        className="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all outline-none bg-slate-50 focus:bg-white appearance-none cursor-pointer disabled:bg-slate-100 disabled:text-slate-400"
                      >
                        <option value="" disabled>-- 請選擇您的職稱 --</option>
                        <option value="醫師">醫師</option>
                        <option value="護理師">護理師</option>
                        <option value="醫事人員">醫事人員</option>
                        <option value="行政人員">行政人員</option>
                        <option value="其他">其他</option>
                      </select>
                      <div className="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-slate-400">
                        <svg className="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" /></svg>
                      </div>
                    </div>
                  </div>

                  {/* 茶水點心 */}
                  <div className="space-y-3">
                    <label className="text-sm font-semibold text-slate-700 flex items-center">
                      <Coffee className="w-4 h-4 mr-1 text-slate-400" /> 是否需要茶水點心？
                    </label>
                    <div className="flex space-x-4">
                      <label className={`flex-1 relative border rounded-xl p-3 cursor-pointer transition-all ${formData.needsSnack === 'yes' ? 'border-teal-500 bg-teal-50 text-teal-700' : 'border-slate-200 hover:bg-slate-50'} ${status === 'submitting' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                        <input
                          type="radio"
                          name="needsSnack"
                          value="yes"
                          disabled={status === 'submitting'}
                          checked={formData.needsSnack === 'yes'}
                          onChange={handleChange}
                          className="absolute opacity-0"
                        />
                        <div className="flex items-center justify-center">
                          <div className={`w-4 h-4 rounded-full border flex items-center justify-center mr-2 ${formData.needsSnack === 'yes' ? 'border-teal-500' : 'border-slate-300'}`}>
                            {formData.needsSnack === 'yes' && <div className="w-2 h-2 rounded-full bg-teal-500" />}
                          </div>
                          <span className="font-medium">是 (Yes)</span>
                        </div>
                      </label>
                      <label className={`flex-1 relative border rounded-xl p-3 cursor-pointer transition-all ${formData.needsSnack === 'no' ? 'border-teal-500 bg-teal-50 text-teal-700' : 'border-slate-200 hover:bg-slate-50'} ${status === 'submitting' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                        <input
                          type="radio"
                          name="needsSnack"
                          value="no"
                          disabled={status === 'submitting'}
                          checked={formData.needsSnack === 'no'}
                          onChange={handleChange}
                          className="absolute opacity-0"
                        />
                        <div className="flex items-center justify-center">
                          <div className={`w-4 h-4 rounded-full border flex items-center justify-center mr-2 ${formData.needsSnack === 'no' ? 'border-teal-500' : 'border-slate-300'}`}>
                            {formData.needsSnack === 'no' && <div className="w-2 h-2 rounded-full bg-teal-500" />}
                          </div>
                          <span className="font-medium">否 (No)</span>
                        </div>
                      </label>
                    </div>
                  </div>

                  {/* 會前提問 */}
                  <div className="space-y-2">
                    <label htmlFor="question" className="text-sm font-semibold text-slate-700 flex items-center">
                      <MessageSquare className="w-4 h-4 mr-1 text-slate-400" /> 會前提問
                    </label>
                    <textarea
                      id="question"
                      name="question"
                      rows="4"
                      disabled={status === 'submitting'}
                      value={formData.question}
                      onChange={handleChange}
                      className="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all outline-none bg-slate-50 focus:bg-white resize-none disabled:bg-slate-100 disabled:text-slate-400"
                      placeholder="您目前在行政工作上遇到的困難？或最想了解關於「敏捷」的哪個部分？"
                    ></textarea>
                  </div>

                  {/* 按鈕 */}
                  <div className="pt-4">
                    <button
                      type="submit"
                      disabled={status === 'submitting'}
                      className={`w-full flex items-center justify-center py-4 bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 ${status === 'submitting' ? 'opacity-75 cursor-wait transform-none' : ''}`}
                    >
                      {status === 'submitting' ? (
                        <>
                          <Loader2 className="w-5 h-5 mr-2 animate-spin" />
                          處理中...
                        </>
                      ) : (
                        <>
                          <Send className="w-5 h-5 mr-2" />
                          確認報名
                        </>
                      )}
                    </button>
                    <p className="text-center text-xs text-slate-400 mt-4">
                      本報名資料僅供本次研討會聯繫與餐點統計使用。
                    </p>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        {/* 頁尾 */}
        <footer className="mt-12 text-center border-t border-slate-200 pt-8 pb-8">
          <p className="text-slate-600 font-medium">主辦單位：教學部</p>
          <div className="flex flex-col md:flex-row justify-center items-center gap-2 mt-2 text-sm text-slate-500">
            <span>聯絡人：盧英云</span>
            <span className="hidden md:inline text-slate-300">|</span>
            <span>分機：57425</span>
          </div>
          <p className="mt-4 text-xs text-slate-300">
            © 2025 Hello World Conference. Designed with Agile Thinking.
          </p>
        </footer>

      </div>
    </div>
  );
};

export default App;
